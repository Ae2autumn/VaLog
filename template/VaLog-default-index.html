<!DOCTYPE html>
<html lang="zh-CN">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>{{ article.title }} - {{ blog.name }}</title>
   <link rel="icon" href="{{ blog.favicon }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
   <noscript>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   </noscript>
   <style>
      * {
         margin: 0;
         padding: 0;
         box-sizing: border-box;
      }

      body.dark-mode {
         background-color: #121212;
         color: #ffffff;
      }
      
      body.dark-mode .header {
         border-bottom-color: #333;
      }
      
      body.dark-mode .title {
         color: #fff;
      }
      
      body.dark-mode .summary {
         color: #ccc;
      }
      
      body.dark-mode .date {
         color: #999;
      }
      
      body.dark-mode .tag {
         background-color: #333;
         color: #fff;
      }
      
      body.dark-mode h1,
      body.dark-mode h2,
      body.dark-mode h3,
      body.dark-mode h4,
      body.dark-mode h5,
      body.dark-mode h6 {
         border-bottom-color: #333;
         color: #fff;
      }
      
      body.dark-mode .comments {
         border-top-color: #333;
      }
      
      body.dark-mode .floating-btn {
         background-color: #000;
         color: #fff;
         box-shadow: 0 4px 12px rgba(255, 0, 0, 0.3);
      }
      
      body.dark-mode .side-menu {
         background-color: #111;
         border-color: #333;
      }
      
      body.dark-mode .menu-left {
         background-color: #111;
      }
      
      body.dark-mode .chapter-item {
         border-bottom-color: #222;
         color: #ccc;
      }
      
      body.dark-mode .chapter-item.h2-item {
         color: #888;
      }
      
      body.dark-mode .menu-right {
         background-color: #222;
      }
      
      body.dark-mode .close-btn {
         background-color: #222;
         color: #fff;
         border-top-color: #333;
      }

      body {
         background-color: #000;
         color: #fff;
         font-family: Arial, sans-serif;
         line-height: 1.6;
         padding: 20px;
         max-width: 1000px;
         margin: 0 auto;
         position: relative;
         min-height: 200vh;
         transition: background-color 0.5s ease, color 0.5s ease;
      }

      .header {
         margin-bottom: 30px;
         padding: 20px;
         border-bottom: 1px solid #333;
         transition: border-color 0.5s ease;
      }

      .title {
         font-size: 2.5rem;
         margin-bottom: 10px;
         color: #fff;
         transition: color 0.5s ease;
      }

      .summary {
         font-size: 1.1rem;
         margin-bottom: 15px;
         color: #ccc;
         transition: color 0.5s ease;
      }

      .date {
         color: #999;
         font-size: 0.9rem;
         margin-bottom: 10px;
         transition: color 0.5s ease;
      }

      .tags {
         display: flex;
         flex-wrap: wrap;
         gap: 10px;
         margin-bottom: 20px;
      }

      .tag {
         background-color: #333;
         color: #fff;
         padding: 5px 10px;
         border-radius: 3px;
         font-size: 0.9rem;
         transition: background-color 0.5s ease, color 0.5s ease;
      }

      .content {
         padding: 20px;
         margin-bottom: 50px;
         transition: color 0.5s ease;
      }

      .content p {
         margin-bottom: 20px;
      }

      .content strong {
         color: #f00;
      }

      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
         margin: 30px 0 15px;
         padding-bottom: 10px;
         border-bottom: 1px solid #333;
         transition: border-color 0.5s ease, color 0.5s ease;
      }

      .comments {
         margin-top: 50px;
         padding: 20px;
         border-top: 1px solid #333;
         transition: border-color 0.5s ease;
      }

      .floating-btn {
         position: fixed;
         bottom: 30px;
         right: 30px;
         width: 60px;
         height: 60px;
         background-color: #000;
         color: #fff;
         border-radius: 50%;
         display: flex;
         justify-content: center;
         align-items: center;
         cursor: pointer;
         font-size: 24px;
         z-index: 1000;
         box-shadow: 0 4px 12px rgba(255, 0, 0, 0.3);
         border: none;
         outline: none;
         transition: background-color 0.5s ease, box-shadow 0.5s ease;
      }

      .side-menu {
         position: fixed;
         bottom: 30px;
         right: 30px;
         width: 250px;
         height: 400px;
         background-color: #111;
         border: 1px solid #333;
         border-radius: 8px;
         display: none;
         flex-direction: row;
         z-index: 999;
         overflow: hidden;
         box-shadow: 0 4px 20px rgba(0, 0, 0, 0.8);
         transform-origin: bottom right;
         transition: background-color 0.5s ease, border-color 0.5s ease;
      }

      .side-menu.active {
         display: flex;
         animation: menuAppear 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
      }

      @keyframes menuAppear {
         0% {
            transform: scale(0.1);
            opacity: 0;
         }

         100% {
            transform: scale(1);
            opacity: 1;
         }
      }

      .menu-left {
         width: 360px;
         padding: 20px;
         overflow-y: auto;
         scrollbar-width: none;
         transition: background-color 0.5s ease;
      }

      .menu-left::-webkit-scrollbar {
         display: none;
      }

      .chapter-item {
         padding: 10px 0;
         border-bottom: 1px solid #222;
         cursor: pointer;
         color: #ccc;
         transition: all 0.2s;
      }

      .chapter-item.h1-item {
         padding-left: 0;
      }

      .chapter-item.h2-item {
         padding-left: 20px;
         color: #888;
         font-size: 0.9em;
      }

      .chapter-item:hover {
         color: #f00;
      }

      .chapter-item.h1-item:hover {
         padding-left: 5px;
      }

      .chapter-item.h2-item:hover {
         padding-left: 25px;
      }

      .menu-right {
         width: 50px;
         height: 100%;
         display: flex;
         flex-direction: column;
         background-color: #222;
         transition: background-color 0.5s ease;
      }

      .menu-buttons {
         flex: 1;
         display: flex;
         flex-direction: column;
         justify-content: space-between;
         align-items: center;
         padding: 20px 0;
         width: 100%;
         margin-left: 1px;
      }

      .menu-btn {
         color: #fff;
         background: none;
         border: none;
         padding: 12px;
         cursor: pointer;
         transition: all 0.2s;
         font-size: 16px;
         width: 60px;
         height: 60px;
         text-align: center;
         border-radius: 5px;
         display: flex;
         justify-content: center;
         align-items: center;
      }

      .menu-btn:hover {
         color: #f00;
         background-color: rgba(255, 0, 0, 0.1);
      }

      .close-btn {
         height: 50px;
         background-color: #222;
         color: #fff;
         border: none;
         border-top: 1px solid #333;
         cursor: pointer;
         font-size: 16px;
         transition: background-color 0.2s;
         width: 100%;
         margin-left: 1px;
      }

      .close-btn:hover {
         background-color: #d00;
      }

      .menu-mask {
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background-color: rgba(0, 0, 0, 0.5);
         z-index: 998;
         display: none;
         transition: background-color 0.5s ease;
      }

      .menu-mask.active {
         display: block;
      }

      body.light-mode {
         background-color: #fff;
         color: #000;
      }

      body.light-mode .header {
         border-bottom-color: #ddd;
      }

      body.light-mode .title {
         color: #000;
      }

      body.light-mode .summary {
         color: #666;
      }

      body.light-mode .date {
         color: #777;
      }

      body.light-mode .tag {
         background-color: #eee;
         color: #000;
      }

      body.light-mode h1,
      body.light-mode h2,
      body.light-mode h3,
      body.light-mode h4,
      body.light-mode h5,
      body.light-mode h6 {
         border-bottom-color: #ddd;
         color: #000;
      }

      body.light-mode .comments {
         border-top-color: #ddd;
      }

      body.light-mode .floating-btn {
         background-color: #fff;
         color: #000;
         box-shadow: 0 4px 12px rgba(255, 0, 0, 0.3);
      }

      body.light-mode .side-menu {
         background-color: #fff;
         border-color: #ddd;
         box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      }

      body.light-mode .menu-left {
         background-color: #fff;
      }

      body.light-mode .chapter-item {
         border-bottom-color: #eee;
         color: #333;
      }

      body.light-mode .chapter-item.h2-item {
         color: #666;
      }

      body.light-mode .chapter-item:hover {
         color: #f00;
      }

      body.light-mode .menu-right {
         background-color: #f5f5f5;
      }

      body.light-mode .menu-btn {
         color: #000;
      }

      body.light-mode .menu-btn:hover {
         color: #f00;
         background-color: rgba(255, 0, 0, 0.1);
      }

      body.light-mode .close-btn {
         background-color: #f5f5f5;
         color: #000;
         border-top-color: #ddd;
      }

      body.light-mode .close-btn:hover {
         background-color: #d00;
         color: #fff;
      }

      body.light-mode .menu-mask {
         background-color: rgba(0, 0, 0, 0.3);
      }
   </style>
</head>

<body class="{% if blog.theme.mode == 'light' %}light-mode{% else %}dark-mode{% endif %}">
   <div class="header">
      <h1 class="title">{{ article.title | default('文章标题') }}</h1>
      <p class="summary">{{ article.summary }}</p>
      <div class="date">{{ article.date | default('发布日期') }}</div>
      <div class="tags">
         {% for tag in article.tags %}
         <span class="tag">{{ tag }}</span>
         {% endfor %}
      </div>
   </div>

   <div class="content">
      {{ article.content | safe | default('') }}
   </div>

   <div class="comments">
   </div>

   <button class="floating-btn" id="menuToggle" style="color: #fff">☰</button>

   <div class="menu-mask" id="menuMask"></div>

   <div class="side-menu" id="sideMenu">
      <div class="menu-left" id="chapterList">
      </div>

      <div class="menu-right">
         <div class="menu-buttons">
            <button class="menu-btn" id="toBottomBtn">▼</button>
            <button class="menu-btn" id="middleBtn">◎</button>
            <button class="menu-btn" id="toTopBtn">▲</button>
         </div>
         <button class="close-btn" id="closeBtn">╳</button>
      </div>
   </div>

   <script>
      const menuToggle = document.getElementById('menuToggle');
      const sideMenu = document.getElementById('sideMenu');
      const menuMask = document.getElementById('menuMask');
      const closeBtn = document.getElementById('closeBtn');
      const toBottomBtn = document.getElementById('toBottomBtn');
      const middleBtn = document.getElementById('middleBtn');
      const toTopBtn = document.getElementById('toTopBtn');
      const chapterList = document.getElementById('chapterList');
      
      document.querySelectorAll('h1, h2').forEach((el, index) => {
         el.id = `heading-${index}`;
      });
      
      function applyTheme() {
        // 优先读取 localStorage
        const savedTheme = localStorage.getItem('theme');
        
        if (savedTheme) {
          // 使用用户保存的主题
          if (savedTheme === 'light') {
            document.body.classList.add('light-mode');
          } else {
            document.body.classList.remove('light-mode');
          }
        } else {
          // 使用服务器配置的主题
          const configTheme = "{{ blog.theme.mode }}";
          const theme = configTheme || 'dark';
          if (theme === 'light') {
            document.body.classList.add('light-mode');
          } else {
            document.body.classList.remove('light-mode');
          }
        }
      }
      
      applyTheme();
      
      const h1Elements = Array.from(document.querySelectorAll('h1')).slice(1);
      const h2Elements = Array.from(document.querySelectorAll('h2'));
      const allHeadings = [...h1Elements, ...h2Elements].sort((a, b) => a.offsetTop - b.offsetTop);
      
      allHeadings.forEach((heading) => {
         const listItem = document.createElement('div');
         const isH2 = heading.tagName === 'H2';
         listItem.className = isH2 ? 'chapter-item h2-item' : 'chapter-item h1-item';
         listItem.textContent = heading.textContent;
         listItem.dataset.id = heading.id;
         listItem.addEventListener('click', (e) => {
            e.stopPropagation();
            heading.scrollIntoView({ behavior: 'smooth', block: 'start' });
            closeMenu();
         });
         chapterList.appendChild(listItem);
      });
      
      menuToggle.addEventListener('click', (e) => {
         e.stopPropagation();
         sideMenu.classList.add('active');
         menuMask.classList.add('active');
         menuToggle.style.display = 'none';
      });
      
      function closeMenu() {
         sideMenu.classList.remove('active');
         menuMask.classList.remove('active');
         menuToggle.style.display = 'flex';
      }
      
      closeBtn.addEventListener('click', (e) => {
         e.stopPropagation();
         closeMenu();
      });
      
      menuMask.addEventListener('click', (e) => {
         e.stopPropagation();
         closeMenu();
      });
      
      sideMenu.addEventListener('click', (e) => {
         e.stopPropagation();
      });
      
      toBottomBtn.addEventListener('click', (e) => {
         e.stopPropagation();
         window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
         closeMenu();
      });
      
      middleBtn.addEventListener('click', (e) => {
         e.stopPropagation();
         window.scrollTo({ top: document.body.scrollHeight / 2, behavior: 'smooth' });
         closeMenu();
      });
      
      toTopBtn.addEventListener('click', (e) => {
         e.stopPropagation();
         window.scrollTo({ top: 0, behavior: 'smooth' });
         closeMenu();
      });
      
      function updateProgress() {
         const scrollHeight = document.documentElement.scrollHeight - window.innerHeight;
         const scrollPosition = window.scrollY;
         const scrollPercent = Math.min(scrollPosition / scrollHeight, 1);
         const redValue = Math.floor(scrollPercent * 255);
         const color = `rgb(${redValue}, 0, 0)`;
         menuToggle.style.backgroundColor = color;
         menuToggle.style.boxShadow = `0 4px 12px rgba(${redValue}, 0, 0, 0.3)`;
      }
      
      window.addEventListener('scroll', updateProgress, { passive: true });
      window.addEventListener('resize', updateProgress, { passive: true });
      updateProgress();
   </script>
</body>

</html>it-box-orient: vertical;
         word-break: break-word;
      }

      .card-content-main {
         flex: 1;
         overflow-y: auto;
         scrollbar-width: none;
         -ms-overflow-style: none;
         margin-bottom: 10px;
         padding-right: 5px;
         word-wrap: break-word;
         overflow-wrap: break-word;
         word-break: break-word;
      }

      .card-content-main::-webkit-scrollbar {
         display: none;
      }

      .card-content-main p {
         font-size: 14px;
         line-height: 1.5;
         margin-bottom: 10px;
         opacity: 0.9;
         color: white;
         word-wrap: break-word;
         overflow-wrap: break-word;
         word-break: break-word;
      }

      .card-footer {
         flex-shrink: 0;
         padding-top: 10px;
         display: flex;
         justify-content: flex-end;
      }

      .mobile-card-btn {
         background-color: rgba(255, 255, 255, 0.2);
         color: white;
         border: none;
         padding: 8px 16px;
         border-radius: 5px;
         cursor: pointer;
         font-weight: 500;
         font-size: 14px;
         transition: background-color 0.2s ease-out, transform 0.2s ease-out;
         will-change: transform, background-color;
         contain: layout style;
         white-space: nowrap;
      }

      .special-card {
         background: linear-gradient(135deg, var(--primary-color), #c0392b);
         color: white;
         border-radius: 10px;
         padding: 15px;
         box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
         cursor: pointer;
         transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
         overflow: hidden;
         flex-shrink: 0;
         will-change: transform, background;
         contain: layout style;
         z-index: 1;
         position: relative;
      }

      .special-card-header {
         display: flex;
         justify-content: space-between;
         align-items: center;
         margin-bottom: 0;
         padding: 0;
         cursor: pointer;
         user-select: none;
         -webkit-user-select: none;
         -moz-user-select: none;
         -ms-user-select: none;
         will-change: transform;
         transition: transform 0.2s ease-out;
         contain: layout style;
      }

      .special-card-title {
         font-size: 18px;
         font-weight: 600;
         color: white;
         margin: 0;
         pointer-events: none;
         will-change: transform;
         transition: transform 0.2s ease-out;
         contain: layout style;
         white-space: nowrap;
         overflow: hidden;
         text-overflow: ellipsis;
      }

      .special-card-content {
         max-height: 0;
         opacity: 0;
         overflow: hidden;
         transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
         will-change: max-height, opacity, margin, padding;
         contain: layout style;
         padding-top: 0;
         margin-top: 0;
         transform-origin: top;
      }

      .special-card.expanded .special-card-content {
         max-height: 320px;
         opacity: 1;
         margin-top: 10px;
      }

      .special-cards-container {
         display: flex;
         flex-direction: column;
         gap: 15px;
         height: auto;
         max-height: 194px;
         overflow-y: auto;
         scrollbar-width: none;
         -ms-overflow-style: none;
         will-change: transform;
         padding-right: 0px;
      }

      .special-cards-container::-webkit-scrollbar {
         display: none;
      }

      .special-card-item {
         background-color: rgba(255, 255, 255, 0.1);
         border-radius: 8px;
         padding: 15px;
         box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
         display: flex;
         flex-direction: column;
         flex-shrink: 0;
         height: 187px;
         overflow: hidden;
         cursor: auto;
         will-change: transform, opacity;
         transition: transform 0.2s ease-out, opacity 0.2s ease-out;
         contain: layout style;
      }

      .special-card-item-content {
         display: flex;
         flex-direction: column;
         height: 100%;
         overflow: hidden;
      }

      .special-card-item .card-tags {
         margin-bottom: 8px;
      }

      .special-card-item h4 {
         font-size: 16px;
         font-weight: 600;
         margin-bottom: 8px;
         color: white;
         flex-shrink: 0;
         will-change: transform;
         transition: transform 0.2s ease-out;
         contain: layout style;
         overflow: hidden;
         text-overflow: ellipsis;
         white-space: nowrap;
      }

      .special-card-item-content-main {
         flex: 1;
         overflow-y: auto;
         scrollbar-width: none;
         -ms-overflow-style: none;
         margin-bottom: 8px;
         padding-right: 5px;
         word-wrap: break-word;
         overflow-wrap: break-word;
         word-break: break-word;
      }

      .special-card-item-content-main::-webkit-scrollbar {
         display: none;
      }

      .special-card-item-content-main p {
         font-size: 14px;
         line-height: 1.5;
         margin-bottom: 8px;
         opacity: 0.9;
         color: white;
         word-wrap: break-word;
         overflow-wrap: break-word;
         word-break: break-word;
      }

      .special-card-item-footer {
         flex-shrink: 0;
         padding-top: 8px;
         display: flex;
         justify-content: flex-end;
      }

      .special-card-btn {
         background-color: rgba(255, 255, 255, 0.2);
         color: white;
         border: none;
         padding: 8px 16px;
         border-radius: 5px;
         cursor: pointer;
         font-weight: 500;
         font-size: 14px;
         transition: background-color 0.2s ease-out, transform 0.2s ease-out;
         will-change: transform, background-color;
         contain: layout style;
         white-space: nowrap;
      }

      .special-card.only-content {
         padding: 0;
         background: transparent;
         box-shadow: none;
         cursor: default;
         border-radius: 10;
         height: auto;
         min-height: 0;
      }

      .special-card.only-content .special-card-header {
         display: none;
      }

      .special-card.only-content .special-card-content {
         max-height: none;
         opacity: 1;
         margin-top: 0;
         padding: 0;
         overflow: visible;
         height: auto;
         min-height: 0;
         cursor: auto;
      }

      .special-card.only-content .special-cards-container {
         display: block;
         max-height: none;
         overflow: visible;
         gap: 0;
         height: auto;
         min-height: 0;
         padding: 0;
         margin: 0;
      }

      .special-card.only-content .special-card-item {
         background-color: transparent;
         padding: 0;
         margin: 0;
         box-shadow: none;
         height: auto;
         min-height: 0;
         max-height: none;
         border-radius: 10;
         cursor: default;
      }

      .special-card.only-content .special-card-item-content {
         display: block;
         height: auto;
         min-height: 0;
         max-height: none;
         overflow: visible;
         padding: 0;
         margin: 0;
      }

      .special-card.only-content .special-card-item-content-main {
         overflow: visible;
         max-height: none;
         height: auto;
         min-height: 0;
         padding: 0;
         margin: 0;
         color: white;
         font-size: 16px;
         line-height: 1.6;
         opacity: 0.9;
         font-style: italic;
         text-align: center;
         background: transparent;
         border-radius: 0;
         cursor: default;
         word-wrap: break-word;
         overflow-wrap: break-word;
         word-break: break-word;
      }

      .special-card.only-content .card-tags,
      .special-card.only-content .special-card-item h4,
      .special-card.only-content .special-card-item-footer {
         display: none;
      }

      .special-card-item-content-simple {
         color: white;
         font-size: 16px;
         line-height: 1.6;
         opacity: 0.9;
         font-style: italic;
         text-align: center;
         padding: 20px 15px;
         background: rgba(255, 255, 255, 0.05);
         border-radius: 8px;
         cursor: default;
         width: 100%;
         box-sizing: border-box;
         word-wrap: break-word;
         overflow-wrap: break-word;
         word-break: break-word;
      }

      .search-overlay {
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background-color: rgba(0, 0, 0, 0.8);
         z-index: 1000;
         display: none;
         justify-content: center;
         align-items: center;
         opacity: 0;
         transition: opacity 0.3s ease;
         backdrop-filter: blur(5px);
      }

      .search-overlay.active {
         display: flex;
         opacity: 1;
      }

      .search-container {
         width: 90%;
         max-width: 500px;
         height: auto;
         background-color: var(--dark-card);
         border-radius: 12px;
         padding: 25px;
         box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
         transform: translateY(20px);
         opacity: 0;
         transition: transform 0.3s ease, opacity 0.3s ease;
         position: relative;
         word-wrap: break-word;
         overflow-wrap: break-word;
         word-break: break-word;
      }

      .search-overlay.active .search-container {
         transform: translateY(0);
         opacity: 1;
      }

      .search-input-container {
         position: relative;
         margin-bottom: 20px;
      }

      .search-input {
         width: 100%;
         padding: 15px 20px;
         background-color: rgba(255, 255, 255, 0.1);
         border: 2px solid rgba(255, 255, 255, 0.2);
         border-radius: 8px;
         color: white;
         font-size: 16px;
         outline: none;
         transition: all 0.3s ease;
         white-space: nowrap;
         overflow: hidden;
         text-overflow: ellipsis;
      }

      .search-input:focus {
         border-color: var(--primary-color);
         background-color: rgba(255, 255, 255, 0.15);
      }

      .search-input.error {
         border-color: #ff0000 !important;
         animation: shake 0.5s ease-in-out;
      }

      @keyframes shake {

         0%,
         100% {
            transform: translateX(0);
         }

         25% {
            transform: translateX(-5px);
         }

         75% {
            transform: translateX(5px);
         }
      }

      .search-options {
         display: flex;
         gap: 10px;
         flex-wrap: wrap;
         justify-content: center;
      }

      .search-option {
         padding: 8px 16px;
         background-color: rgba(255, 255, 255, 0.1);
         color: white;
         border: none;
         border-radius: 5px;
         cursor: pointer;
         font-size: 14px;
         transition: all 0.2s ease;
         white-space: nowrap;
         overflow: hidden;
         text-overflow: ellipsis;
      }

      .search-option:hover {
         background-color: rgba(255, 255, 255, 0.2);
      }

      .search-option.active {
         background-color: var(--primary-color);
         color: white;
         box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4);
      }

      .search-mode-indicator {
         position: absolute;
         top: 10px;
         right: 10px;
         background-color: var(--primary-color);
         color: white;
         padding: 5px 10px;
         border-radius: 4px;
         font-size: 12px;
         display: none;
         z-index: 100;
         white-space: nowrap;
         overflow: hidden;
         text-overflow: ellipsis;
      }

      .light-mode {
         background-color: var(--light-bg);
         color: white;
      }

      .light-mode .mobile-top-section {
         background-color: var(--light-primary);
      }

      .light-mode .mobile-top-card {
         background-color: white;
         color: gray;
      }

      .light-mode .mobile-top-card h2 {
         color: #cdcdcd;
      }

      .light-mode .floating-menu {
         background-color: white;
         color: gray;
      }

      .light-mode .menu-item {
         border-bottom-color: #eee;
         color: gray;
      }

      .light-mode .menu-item:hover {
         color: var(--light-primary);
      }

      .light-mode .rectangle-card:nth-child(5n+1) {
         background: linear-gradient(135deg, #ffb6c1, #ff69b4);
      }

      .light-mode .rectangle-card:nth-child(5n+1).active {
         background: linear-gradient(135deg, #ff69b4, #ff1493);
      }

      .light-mode .rectangle-card:nth-child(5n+2) {
         background: linear-gradient(135deg, #98fb98, #90ee90);
      }

      .light-mode .rectangle-card:nth-child(5n+2).active {
         background: linear-gradient(135deg, #90ee90, #7cfc00);
      }

      .light-mode .rectangle-card:nth-child(5n+3) {
         background: linear-gradient(135deg, #add8e6, #87ceeb);
      }

      .light-mode .rectangle-card:nth-child(5n+3).active {
         background: linear-gradient(135deg, #87ceeb, #6495ed);
      }

      .light-mode .rectangle-card:nth-child(5n+4) {
         background: linear-gradient(135deg, #fffacd, #f0e68c);
      }

      .light-mode .rectangle-card:nth-child(5n+4).active {
         background: linear-gradient(135deg, #f0e68c, #ffd700);
      }

      .light-mode .rectangle-card:nth-child(5n) {
         background: linear-gradient(135deg, #d3d3d3, #c0c0c0);
      }

      .light-mode .rectangle-card:nth-child(5n).active {
         background: linear-gradient(135deg, #c0c0c0, #a9a9a9);
      }

      .light-mode .special-card {
         background: linear-gradient(135deg, #d8bfd8, #dda0dd);
      }

      .light-mode .special-card.expanded {
         background: linear-gradient(135deg, #dda0dd, #eeb1ee);
      }

      .light-mode .special-card-item {
         background-color: rgba(255, 255, 255, 0.2);
      }

      .light-mode .special-card-item h4 {
         color: white;
      }

      .light-mode .card-tag {
         background-color: rgba(0, 0, 0, 0.1);
         color: white;
      }

      .light-mode .date-tag {
         background-color: rgba(0, 0, 0, 0.15) !important;
         border-left-color: var(--light-primary);
      }

      .light-mode .vertical-title {
         color: white;
         text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
      }

      .light-mode .rectangle-card.active .card-content-expanded h2 {
         color: white;
      }

      .light-mode .special-card-title {
         color: white;
      }

      }

      .light-mode .search-overlay {
         background-color: rgba(0, 0, 0, 0.5);
      }

      .light-mode .search-container {
         background-color: white;
         color: #333;
      }

      .light-mode .search-input {
         background-color: rgba(0, 0, 0, 0.05);
         border-color: rgba(0, 0, 0, 0.1);
         color: #333;
      }

      .light-mode .search-input:focus {
         border-color: var(--light-primary);
         background-color: rgba(0, 0, 0, 0.08);
      }

      .light-mode .search-input.error {
         border-color: #ff0000 !important;
      }

      .light-mode .search-option {
         background-color: rgba(0, 0, 0, 0.05);
         color: #333;
      }

      .light-mode .search-option:hover {
         background-color: rgba(0, 0, 0, 0.1);
      }

      .light-mode .search-option.active {
         background-color: var(--light-primary);
         color: white;
         box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
      }

      .menu-btn:active,
      .close-menu:active,
      .mobile-card-btn:active,
      .special-card-btn:active {
         transform: scale(0.95);
      }

      .card-tag:hover {
         transform: translateY(-1px);
         background-color: rgba(255, 255, 255, 0.2);
      }

      .card-title-container h2:hover {
         transform: translateX(2px);
      }

      .special-card-item:hover {
         transform: translateY(-2px);
         opacity: 0.95;
      }

      .special-card-title:hover {
         transform: translateX(2px);
      }

      .mobile-top-section,
      .mobile-top-card,
      .special-card,
      .special-card-content,
      .rectangle-card,
      .search-overlay,
      .search-container {
         backface-visibility: hidden;
         -webkit-backface-visibility: hidden;
         perspective: 1000;
         -webkit-perspective: 1000;
      }

      .mobile-cards-wrapper,
      .special-cards-container,
      .card-content-main,
      .special-card-item-content-main {
         scroll-behavior: smooth;
         -webkit-overflow-scrolling: touch;
      }
   </style>
</head>

<body class="{{ THEME_MODE }}-mode">
   <div class="container">
      <div class="mobile-layout">
         <div class="mobile-top-section expanded" id="mobileTopSection">
            <div class="mobile-top-bar">
               <div class="avatar" role="img" aria-label="Avatar">
                  <img src="{{ BLOG_AVATAR }}" alt="avatar"
                                                                                                                                          style="width:100%;height:100%;border-radius:50%;object-fit:cover;">
               </div>
               <div class="mobile-title-container" id="titleToggle" tabindex="0" role="button"
                                                                                                                                       aria-label="Toggle Title">
                  <div class="mobile-title">{{ BLOG_NAME }}</div>
               </div>
               <button class="menu-btn" id="menuBtn" aria-label="Menu" aria-expanded="false"
                                                                                                                                       aria-controls="floatingMenu">≡</button>
            </div>
            <div class="mobile-top-card">
               <p>{{ BLOG_DESCRIPTION }}</p>
            </div>

            <div class="floating-menu" id="floatingMenu" role="menu" aria-hidden="true">
               <div class="menu-items" id="menuItems">
                  <div class="menu-item" id="searchMenuItem" role="menuitem" tabindex="0">搜索</div>
                  <div class="menu-item" id="darkModeToggle" role="menuitem" tabindex="0">日间模式</div>
               </div>
            </div>
         </div>

         <div class="article-list-section" id="articleListSection">
            <div class="mobile-cards-container">
               <div class="mobile-cards-wrapper" id="mobileCardsWrapper">
               </div>
            </div>
         </div>

         <section class="special-card" id="specialCard" aria-labelledby="specialCardTitle" aria-expanded="false">
            <div class="special-card-header">
               <h3 id="specialCardTitle" class="special-card-title">{{ SPECIAL_NAME }}</h3>
            </div>
            <div class="special-card-content" id="specialCardContent">
               <div class="special-cards-container" id="specialCardsContainer">
               </div>
            </div>
         </section>
      </div>
   </div>

   <div class="search-overlay" id="searchOverlay">
      <div class="search-container">
         <div class="search-input-container">
            <input type="text" class="search-input" id="searchInput" placeholder="Enter确认,点击标题退出" autocomplete="off">
         </div>
         <div class="search-options" id="searchOptions">
            <button class="search-option active" data-type="title">标题</button>
            <button class="search-option" data-type="tag">标签</button>
            <button class="search-option" data-type="content">简介</button>
         </div>
      </div>
   </div>

   <script>
      // ==================== 数据注入点 (由生成引擎替换) ====================
      const blogData = {
        articles: {{ ARTICLES_JSON }},
        specials: {{ SPECIALS_JSON }}
      };
      const menuItemsData = {{ MENU_ITEMS_JSON }};
      const blogConfig = {
        themeColor: "{{ PRIMARY_COLOR }}",
        runDate: "{{ TOTAL_TIME }}"
      };
      
      // ==================== 状态管理 ====================
      const SEARCH_TYPES = { TITLE: 'title', TAG: 'tag', CONTENT: 'content' };
      const state = {
        isSearchMode: false,
        currentArticles: [],
        searchType: SEARCH_TYPES.TITLE
      };
      
      // ==================== 主题管理 ====================
      
      // 获取当前主题
      function getCurrentTheme() {
        return document.body.classList.contains('light-mode') ? 'light' : 'dark';
      }
      
      // 设置主题
      function setTheme(theme) {
        const isLight = theme === 'light';
        
        // 切换类
        if (isLight) {
          document.body.classList.add('light-mode');
          document.body.classList.remove('dark-mode');
        } else {
          document.body.classList.add('dark-mode');
          document.body.classList.remove('light-mode');
        }
        
        // 更新按钮文本
        const themeBtn = document.getElementById('darkModeToggle');
        if (themeBtn) {
          themeBtn.textContent = isLight ? '夜间模式' : '日间模式';
        }
        
        // 保存到 localStorage
        localStorage.setItem('theme', theme);
      }
      
      // 切换主题
      function toggleTheme() {
        const currentTheme = getCurrentTheme();
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        setTheme(newTheme);
        closeFloatingMenu();
      }
      
      // 初始化主题
      function initTheme() {
        // 尝试从 localStorage 读取用户设置
        const savedTheme = localStorage.getItem('theme');
        
        if (savedTheme === 'light' || savedTheme === 'dark') {
          // 使用用户保存的设置
          setTheme(savedTheme);
        } else {
          // 如果没有保存的设置，使用初始设置（从HTML的body类获取）
          const initialTheme = document.body.classList.contains('light-mode') ? 'light' : 'dark';
          // 保存初始设置
          setTheme(initialTheme);
        }
      }
      
      // ==================== 核心逻辑 ====================
      
      // 规格 4.4: 仅文本模式触发条件
      function shouldShowOnlyContent(special) {
        const hasTitle = special.title && special.title.trim() !== '';
        const hasTags = special.tags && special.tags.length > 0;
        const hasContent = special.content && special.content.length > 0;
        // 只有内容，没有标题和标签时触发
        return hasContent && !hasTitle && !hasTags;
      }
      
      function renderArticles(articles = blogData.articles, isSearchMode = false) {
        const wrapper = document.getElementById('mobileCardsWrapper');
        wrapper.innerHTML = '';
        
        // 按日期倒序
        const sorted = [...articles].sort((a, b) => new Date(b.date) - new Date(a.date));
      
        sorted.forEach((article, index) => {
          const card = document.createElement('article');
          card.className = 'rectangle-card';
          // 规格 3.3: 默认垂直标题为标签第一个
          const vTitle = article.verticalTitle || (article.tags && article.tags[0]) || 'Blog';
          
          // 构建标签HTML
          let tagsHTML = '';
          if (article.date) {
            tagsHTML += `<span class="card-tag date-tag">${article.date}</span>`;
          }
          if (article.tags && Array.isArray(article.tags)) {
            tagsHTML += article.tags.map(tag => `<span class="card-tag">${tag}</span>`).join('');
          }
          
          // 构建内容HTML
          let contentHTML = '';
          if (article.content && Array.isArray(article.content)) {
            contentHTML = article.content.map(p => `<p>${escapeHtml(p)}</p>`).join('');
          }
          
          card.innerHTML = `
            <div class="vertical-title">${escapeHtml(vTitle)}</div>
            <div class="card-content-expanded">
              <div class="card-tags">
                ${tagsHTML}
              </div>
              <div class="card-title-container">
                <h2>${escapeHtml(article.title)}</h2>
              </div>
              <div class="card-content-main">
                ${contentHTML}
              </div>
              <div class="card-footer">
                <button class="mobile-card-btn" onclick="window.location.href='${escapeHtml(article.url)}'">Read</button>
              </div>
            </div>
          `;
      
          // 搜索模式默认展开第一个，普通模式默认展开第二个(索引1)
          if ((!isSearchMode && index === 1) || (isSearchMode && index === 0)) {
            setTimeout(() => card.classList.add('active'), 100);
          }
      
          card.addEventListener('click', (e) => {
            if (e.target.closest('.mobile-card-btn')) return;
            document.querySelectorAll('.rectangle-card').forEach(c => c !== card && c.classList.remove('active'));
            card.classList.toggle('active');
          });
          wrapper.appendChild(card);
        });
      }
      
      function renderSpecialCards() {
        const container = document.getElementById('specialCardsContainer');
        const specialSection = document.getElementById('specialCard');
        container.innerHTML = '';
      
        if (!blogData.specials || blogData.specials.length === 0) {
          specialSection.style.display = 'none';
          return;
        }
      
        blogData.specials.forEach(special => {
          const item = document.createElement('div');
          
          if (shouldShowOnlyContent(special)) {
            // 仅文本模式
            specialSection.classList.add('only-content', 'expanded');
            item.className = 'special-card-item-content-simple';
            
            // 构建纯文本内容
            let contentHTML = '';
            if (special.content && Array.isArray(special.content)) {
              contentHTML = special.content.map(p => `<p>${escapeHtml(p)}</p>`).join('');
            }
            item.innerHTML = contentHTML;
          } else {
            // 正常模式
            item.className = 'special-card-item';
            
            // 构建标签HTML
            let tagsHTML = '';
            if (special.tags && Array.isArray(special.tags)) {
              tagsHTML = special.tags.map(t => `<span class="card-tag">${escapeHtml(t)}</span>`).join('');
            }
            
            // 构建内容HTML
            let contentHTML = '';
            if (special.content && Array.isArray(special.content)) {
              contentHTML = special.content.map(p => `<p>${escapeHtml(p)}</p>`).join('');
            }
            
            // 构建按钮HTML
            let buttonHTML = '';
            if (special.url) {
              buttonHTML = `
                <div class="special-card-item-footer">
                  <button class="special-card-btn" onclick="window.open('${escapeHtml(special.url)}', '_blank')">Visit</button>
                </div>
              `;
            }
            
            item.innerHTML = `
              <div class="special-card-item-content">
                <div class="card-tags">
                  ${tagsHTML}
                </div>
                <h4>${escapeHtml(special.title || '')}</h4>
                <div class="special-card-item-content-main">
                  ${contentHTML}
                </div>
                ${buttonHTML}
              </div>
            `;
          }
          container.appendChild(item);
        });
      }
      
      function renderMenu() {
        const menuContainer = document.getElementById('menuItems');
        const searchBtn = document.getElementById('searchMenuItem');
        const themeBtn = document.getElementById('darkModeToggle');
        
        // 保留搜索和主题切换，清空其他的
        menuContainer.innerHTML = '';
        menuContainer.appendChild(searchBtn);
      
        if (menuItemsData && Array.isArray(menuItemsData)) {
          menuItemsData.forEach(item => {
            // 如果item有url，直接使用
            if (item.url) {
              const link = document.createElement('a');
              link.className = 'menu-item';
              link.href = item.url;
              link.textContent = item.display;
              link.onclick = () => closeFloatingMenu();
              menuContainer.appendChild(link);
            } 
            // 如果item有tag，查找对应的文章
            else if (item.tag) {
              // 在articles中查找对应tag的文章
              const matchedArticle = blogData.articles.find(article => 
                article.tags && article.tags.includes(item.tag)
              );
              
              if (matchedArticle && matchedArticle.url) {
                const link = document.createElement('a');
                link.className = 'menu-item';
                link.href = matchedArticle.url;
                link.textContent = item.display || item.tag;
                link.onclick = () => closeFloatingMenu();
                menuContainer.appendChild(link);
              }
            }
            // 如果既没有url也没有tag，跳过不显示
          });
        }
      
        menuContainer.appendChild(themeBtn);
      }
      
      // ==================== 辅助函数 ====================
      function escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }
      
      // ==================== 交互事件 ====================
      function toggleFloatingMenu() {
        const menu = document.getElementById('floatingMenu');
        const isClosing = menu.classList.contains('active');
        if (isClosing) {
          menu.classList.add('closing');
          menu.classList.remove('active');
          setTimeout(() => menu.classList.remove('closing'), 250);
        } else {
          menu.classList.add('active');
        }
      }
      
      function closeFloatingMenu() {
        const menu = document.getElementById('floatingMenu');
        if(menu.classList.contains('active')) toggleFloatingMenu();
      }
      
      function performSearch() {
        const input = document.getElementById('searchInput');
        const keyword = input.value.trim().toLowerCase();
        if (!keyword) return;
      
        const filtered = blogData.articles.filter(a => {
          if (!a) return false;
          
          if (state.searchType === SEARCH_TYPES.TITLE) {
            return a.title && a.title.toLowerCase().includes(keyword);
          }
          if (state.searchType === SEARCH_TYPES.TAG) {
            return a.tags && a.tags.some(t => t && t.toLowerCase().includes(keyword));
          }
          if (state.searchType === SEARCH_TYPES.CONTENT) {
            return a.content && a.content.some(c => c && c.toLowerCase().includes(keyword));
          }
          return false;
        });
      
        if (filtered.length > 0) {
          state.isSearchMode = true;
          renderArticles(filtered, true);
          document.getElementById('searchOverlay').classList.remove('active');
          input.value = '';
          input.placeholder = '输入关键词搜索...';
        } else {
          input.classList.add('error');
          setTimeout(() => {
            input.classList.remove('error');
            input.placeholder = '未找到相关内容';
          }, 500);
        }
      }
      
      // ==================== 初始化 ====================
      document.addEventListener('DOMContentLoaded', () => {
        // 初始化主题
        initTheme();
        
        // 渲染内容
        renderArticles();
        renderSpecialCards();
        renderMenu();
      
        // 基础事件绑定
        document.getElementById('menuBtn').addEventListener('click', toggleFloatingMenu);
        document.getElementById('searchMenuItem').addEventListener('click', () => {
          document.getElementById('searchOverlay').classList.add('active');
          document.getElementById('searchInput').focus();
          closeFloatingMenu();
        });
        
        // 主题切换按钮 - 使用新的切换函数
        document.getElementById('darkModeToggle').addEventListener('click', toggleTheme);
        
        document.getElementById('titleToggle').addEventListener('click', () => {
          if (state.isSearchMode) {
            state.isSearchMode = false;
            renderArticles();
          } else {
            document.getElementById('mobileTopSection').classList.toggle('expanded');
            document.getElementById('mobileTopSection').classList.toggle('collapsed');
          }
        });
        
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            performSearch();
          }
        });
        
        // 点击外部关闭
        document.addEventListener('click', (e) => {
          if (!e.target.closest('#floatingMenu') && !e.target.closest('#menuBtn')) {
            closeFloatingMenu();
          }
          if (e.target.id === 'searchOverlay') {
            e.target.classList.remove('active');
            const input = document.getElementById('searchInput');
            input.value = '';
            input.placeholder = '输入关键词搜索...';
          }
        });
      
        // 搜索类型切换
        document.querySelectorAll('.search-option').forEach(btn => {
          btn.addEventListener('click', () => {
            document.querySelectorAll('.search-option').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            state.searchType = btn.dataset.type;
          });
        });
      
        // Special Header 点击
        const specialHeader = document.querySelector('.special-card-header');
        if (specialHeader) {
          specialHeader.addEventListener('click', () => {
            const card = document.getElementById('specialCard');
            if (card && !card.classList.contains('only-content')) {
              card.classList.toggle('expanded');
            }
          });
        }
      });
      
      // 设置主题颜色
      if (blogConfig.themeColor) {
        document.documentElement.style.setProperty('--primary-color', blogConfig.themeColor);
      }
   </script>
</body>

</html>it-box-orient: vertical;
         word-break: break-word;
      }

      .card-content-main {
         flex: 1;
         overflow-y: auto;
         scrollbar-width: none;
         -ms-overflow-style: none;
         margin-bottom: 10px;
         padding-right: 5px;
         word-wrap: break-word;
         overflow-wrap: break-word;
         word-break: break-word;
      }

      .card-content-main::-webkit-scrollbar {
         display: none;
      }

      .card-content-main p {
         font-size: 14px;
         line-height: 1.5;
         margin-bottom: 10px;
         opacity: 0.9;
         color: white;
         word-wrap: break-word;
         overflow-wrap: break-word;
         word-break: break-word;
      }

      .card-footer {
         flex-shrink: 0;
         padding-top: 10px;
         display: flex;
         justify-content: flex-end;
      }

      .mobile-card-btn {
         background-color: rgba(255, 255, 255, 0.2);
         color: white;
         border: none;
         padding: 8px 16px;
         border-radius: 5px;
         cursor: pointer;
         font-weight: 500;
         font-size: 14px;
         transition: background-color 0.2s ease-out, transform 0.2s ease-out;
         will-change: transform, background-color;
         contain: layout style;
         white-space: nowrap;
      }

      .special-card {
         background: linear-gradient(135deg, var(--primary-color), #c0392b);
         color: white;
         border-radius: 10px;
         padding: 15px;
         box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
         cursor: pointer;
         transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
         overflow: hidden;
         flex-shrink: 0;
         will-change: transform, background;
         contain: layout style;
         z-index: 1;
         position: relative;
      }

      .special-card-header {
         display: flex;
         justify-content: space-between;
         align-items: center;
         margin-bottom: 0;
         padding: 0;
         cursor: pointer;
         user-select: none;
         -webkit-user-select: none;
         -moz-user-select: none;
         -ms-user-select: none;
         will-change: transform;
         transition: transform 0.2s ease-out;
         contain: layout style;
      }

      .special-card-title {
         font-size: 18px;
         font-weight: 600;
         color: white;
         margin: 0;
         pointer-events: none;
         will-change: transform;
         transition: transform 0.2s ease-out;
         contain: layout style;
         white-space: nowrap;
         overflow: hidden;
         text-overflow: ellipsis;
      }

      .special-card-content {
         max-height: 0;
         opacity: 0;
         overflow: hidden;
         transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
         will-change: max-height, opacity, margin, padding;
         contain: layout style;
         padding-top: 0;
         margin-top: 0;
         transform-origin: top;
      }

      .special-card.expanded .special-card-content {
         max-height: 320px;
         opacity: 1;
         margin-top: 10px;
      }

      .special-cards-container {
         display: flex;
         flex-direction: column;
         gap: 15px;
         height: auto;
         max-height: 194px;
         overflow-y: auto;
         scrollbar-width: none;
         -ms-overflow-style: none;
         will-change: transform;
         padding-right: 0px;
      }

      .special-cards-container::-webkit-scrollbar {
         display: none;
      }

      .special-card-item {
         background-color: rgba(255, 255, 255, 0.1);
         border-radius: 8px;
         padding: 15px;
         box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
         display: flex;
         flex-direction: column;
         flex-shrink: 0;
         height: 187px;
         overflow: hidden;
         cursor: auto;
         will-change: transform, opacity;
         transition: transform 0.2s ease-out, opacity 0.2s ease-out;
         contain: layout style;
      }

      .special-card-item-content {
         display: flex;
         flex-direction: column;
         height: 100%;
         overflow: hidden;
      }

      .special-card-item .card-tags {
         margin-bottom: 8px;
      }

      .special-card-item h4 {
         font-size: 16px;
         font-weight: 600;
         margin-bottom: 8px;
         color: white;
         flex-shrink: 0;
         will-change: transform;
         transition: transform 0.2s ease-out;
         contain: layout style;
         overflow: hidden;
         text-overflow: ellipsis;
         white-space: nowrap;
      }

      .special-card-item-content-main {
         flex: 1;
         overflow-y: auto;
         scrollbar-width: none;
         -ms-overflow-style: none;
         margin-bottom: 8px;
         padding-right: 5px;
         word-wrap: break-word;
         overflow-wrap: break-word;
         word-break: break-word;
      }

      .special-card-item-content-main::-webkit-scrollbar {
         display: none;
      }

      .special-card-item-content-main p {
         font-size: 14px;
         line-height: 1.5;
         margin-bottom: 8px;
         opacity: 0.9;
         color: white;
         word-wrap: break-word;
         overflow-wrap: break-word;
         word-break: break-word;
      }

      .special-card-item-footer {
         flex-shrink: 0;
         padding-top: 8px;
         display: flex;
         justify-content: flex-end;
      }

      .special-card-btn {
         background-color: rgba(255, 255, 255, 0.2);
         color: white;
         border: none;
         padding: 8px 16px;
         border-radius: 5px;
         cursor: pointer;
         font-weight: 500;
         font-size: 14px;
         transition: background-color 0.2s ease-out, transform 0.2s ease-out;
         will-change: transform, background-color;
         contain: layout style;
         white-space: nowrap;
      }

      .special-card.only-content {
         padding: 0;
         background: transparent;
         box-shadow: none;
         cursor: default;
         border-radius: 10;
         height: auto;
         min-height: 0;
      }

      .special-card.only-content .special-card-header {
         display: none;
      }

      .special-card.only-content .special-card-content {
         max-height: none;
         opacity: 1;
         margin-top: 0;
         padding: 0;
         overflow: visible;
         height: auto;
         min-height: 0;
         cursor: auto;
      }

      .special-card.only-content .special-cards-container {
         display: block;
         max-height: none;
         overflow: visible;
         gap: 0;
         height: auto;
         min-height: 0;
         padding: 0;
         margin: 0;
      }

      .special-card.only-content .special-card-item {
         background-color: transparent;
         padding: 0;
         margin: 0;
         box-shadow: none;
         height: auto;
         min-height: 0;
         max-height: none;
         border-radius: 10;
         cursor: default;
      }

      .special-card.only-content .special-card-item-content {
         display: block;
         height: auto;
         min-height: 0;
         max-height: none;
         overflow: visible;
         padding: 0;
         margin: 0;
      }

      .special-card.only-content .special-card-item-content-main {
         overflow: visible;
         max-height: none;
         height: auto;
         min-height: 0;
         padding: 0;
         margin: 0;
         color: white;
         font-size: 16px;
         line-height: 1.6;
         opacity: 0.9;
         font-style: italic;
         text-align: center;
         background: transparent;
         border-radius: 0;
         cursor: default;
         word-wrap: break-word;
         overflow-wrap: break-word;
         word-break: break-word;
      }

      .special-card.only-content .card-tags,
      .special-card.only-content .special-card-item h4,
      .special-card.only-content .special-card-item-footer {
         display: none;
      }

      .special-card-item-content-simple {
         color: white;
         font-size: 16px;
         line-height: 1.6;
         opacity: 0.9;
         font-style: italic;
         text-align: center;
         padding: 20px 15px;
         background: rgba(255, 255, 255, 0.05);
         border-radius: 8px;
         cursor: default;
         width: 100%;
         box-sizing: border-box;
         word-wrap: break-word;
         overflow-wrap: break-word;
         word-break: break-word;
      }

      .search-overlay {
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background-color: rgba(0, 0, 0, 0.8);
         z-index: 1000;
         display: none;
         justify-content: center;
         align-items: center;
         opacity: 0;
         transition: opacity 0.3s ease;
         backdrop-filter: blur(5px);
      }

      .search-overlay.active {
         display: flex;
         opacity: 1;
      }

      .search-container {
         width: 90%;
         max-width: 500px;
         height: auto;
         background-color: var(--dark-card);
         border-radius: 12px;
         padding: 25px;
         box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
         transform: translateY(20px);
         opacity: 0;
         transition: transform 0.3s ease, opacity 0.3s ease;
         position: relative;
         word-wrap: break-word;
         overflow-wrap: break-word;
         word-break: break-word;
      }

      .search-overlay.active .search-container {
         transform: translateY(0);
         opacity: 1;
      }

      .search-input-container {
         position: relative;
         margin-bottom: 20px;
      }

      .search-input {
         width: 100%;
         padding: 15px 20px;
         background-color: rgba(255, 255, 255, 0.1);
         border: 2px solid rgba(255, 255, 255, 0.2);
         border-radius: 8px;
         color: white;
         font-size: 16px;
         outline: none;
         transition: all 0.3s ease;
         white-space: nowrap;
         overflow: hidden;
         text-overflow: ellipsis;
      }

      .search-input:focus {
         border-color: var(--primary-color);
         background-color: rgba(255, 255, 255, 0.15);
      }

      .search-input.error {
         border-color: #ff0000 !important;
         animation: shake 0.5s ease-in-out;
      }

      @keyframes shake {

         0%,
         100% {
            transform: translateX(0);
         }

         25% {
            transform: translateX(-5px);
         }

         75% {
            transform: translateX(5px);
         }
      }

      .search-options {
         display: flex;
         gap: 10px;
         flex-wrap: wrap;
         justify-content: center;
      }

      .search-option {
         padding: 8px 16px;
         background-color: rgba(255, 255, 255, 0.1);
         color: white;
         border: none;
         border-radius: 5px;
         cursor: pointer;
         font-size: 14px;
         transition: all 0.2s ease;
         white-space: nowrap;
         overflow: hidden;
         text-overflow: ellipsis;
      }

      .search-option:hover {
         background-color: rgba(255, 255, 255, 0.2);
      }

      .search-option.active {
         background-color: var(--primary-color);
         color: white;
         box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4);
      }

      .search-mode-indicator {
         position: absolute;
         top: 10px;
         right: 10px;
         background-color: var(--primary-color);
         color: white;
         padding: 5px 10px;
         border-radius: 4px;
         font-size: 12px;
         display: none;
         z-index: 100;
         white-space: nowrap;
         overflow: hidden;
         text-overflow: ellipsis;
      }

      .light-mode {
         background-color: var(--light-bg);
         color: white;
      }

      .light-mode .mobile-top-section {
         background-color: var(--light-primary);
      }

      .light-mode .mobile-top-card {
         background-color: white;
         color: gray;
      }

      .light-mode .mobile-top-card h2 {
         color: #cdcdcd;
      }

      .light-mode .floating-menu {
         background-color: white;
         color: gray;
      }

      .light-mode .menu-item {
         border-bottom-color: #eee;
         color: gray;
      }

      .light-mode .menu-item:hover {
         color: var(--light-primary);
      }

      .light-mode .rectangle-card:nth-child(5n+1) {
         background: linear-gradient(135deg, #ffb6c1, #ff69b4);
      }

      .light-mode .rectangle-card:nth-child(5n+1).active {
         background: linear-gradient(135deg, #ff69b4, #ff1493);
      }

      .light-mode .rectangle-card:nth-child(5n+2) {
         background: linear-gradient(135deg, #98fb98, #90ee90);
      }

      .light-mode .rectangle-card:nth-child(5n+2).active {
         background: linear-gradient(135deg, #90ee90, #7cfc00);
      }

      .light-mode .rectangle-card:nth-child(5n+3) {
         background: linear-gradient(135deg, #add8e6, #87ceeb);
      }

      .light-mode .rectangle-card:nth-child(5n+3).active {
         background: linear-gradient(135deg, #87ceeb, #6495ed);
      }

      .light-mode .rectangle-card:nth-child(5n+4) {
         background: linear-gradient(135deg, #fffacd, #f0e68c);
      }

      .light-mode .rectangle-card:nth-child(5n+4).active {
         background: linear-gradient(135deg, #f0e68c, #ffd700);
      }

      .light-mode .rectangle-card:nth-child(5n) {
         background: linear-gradient(135deg, #d3d3d3, #c0c0c0);
      }

      .light-mode .rectangle-card:nth-child(5n).active {
         background: linear-gradient(135deg, #c0c0c0, #a9a9a9);
      }

      .light-mode .special-card {
         background: linear-gradient(135deg, #d8bfd8, #dda0dd);
      }

      .light-mode .special-card.expanded {
         background: linear-gradient(135deg, #dda0dd, #eeb1ee);
      }

      .light-mode .special-card-item {
         background-color: rgba(255, 255, 255, 0.2);
      }

      .light-mode .special-card-item h4 {
         color: white;
      }

      .light-mode .card-tag {
         background-color: rgba(0, 0, 0, 0.1);
         color: white;
      }

      .light-mode .date-tag {
         background-color: rgba(0, 0, 0, 0.15) !important;
         border-left-color: var(--light-primary);
      }

      .light-mode .vertical-title {
         color: white;
         text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
      }

      .light-mode .rectangle-card.active .card-content-expanded h2 {
         color: white;
      }

      .light-mode .special-card-title {
         color: white;
      }

      }

      .light-mode .search-overlay {
         background-color: rgba(0, 0, 0, 0.5);
      }

      .light-mode .search-container {
         background-color: white;
         color: #333;
      }

      .light-mode .search-input {
         background-color: rgba(0, 0, 0, 0.05);
         border-color: rgba(0, 0, 0, 0.1);
         color: #333;
      }

      .light-mode .search-input:focus {
         border-color: var(--light-primary);
         background-color: rgba(0, 0, 0, 0.08);
      }

      .light-mode .search-input.error {
         border-color: #ff0000 !important;
      }

      .light-mode .search-option {
         background-color: rgba(0, 0, 0, 0.05);
         color: #333;
      }

      .light-mode .search-option:hover {
         background-color: rgba(0, 0, 0, 0.1);
      }

      .light-mode .search-option.active {
         background-color: var(--light-primary);
         color: white;
         box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
      }

      .menu-btn:active,
      .close-menu:active,
      .mobile-card-btn:active,
      .special-card-btn:active {
         transform: scale(0.95);
      }

      .card-tag:hover {
         transform: translateY(-1px);
         background-color: rgba(255, 255, 255, 0.2);
      }

      .card-title-container h2:hover {
         transform: translateX(2px);
      }

      .special-card-item:hover {
         transform: translateY(-2px);
         opacity: 0.95;
      }

      .special-card-title:hover {
         transform: translateX(2px);
      }

      .mobile-top-section,
      .mobile-top-card,
      .special-card,
      .special-card-content,
      .rectangle-card,
      .search-overlay,
      .search-container {
         backface-visibility: hidden;
         -webkit-backface-visibility: hidden;
         perspective: 1000;
         -webkit-perspective: 1000;
      }

      .mobile-cards-wrapper,
      .special-cards-container,
      .card-content-main,
      .special-card-item-content-main {
         scroll-behavior: smooth;
         -webkit-overflow-scrolling: touch;
      }
   </style>
</head>

<body class="{{ THEME_MODE }}-mode">
   <div class="container">
      <div class="mobile-layout">
         <div class="mobile-top-section expanded" id="mobileTopSection">
            <div class="mobile-top-bar">
               <div class="avatar" role="img" aria-label="Avatar">
                  <img src="{{ BLOG_AVATAR }}" alt="avatar"
                                                                                                                                          style="width:100%;height:100%;border-radius:50%;object-fit:cover;">
               </div>
               <div class="mobile-title-container" id="titleToggle" tabindex="0" role="button"
                                                                                                                                       aria-label="Toggle Title">
                  <div class="mobile-title">{{ BLOG_NAME }}</div>
               </div>
               <button class="menu-btn" id="menuBtn" aria-label="Menu" aria-expanded="false"
                                                                                                                                       aria-controls="floatingMenu">≡</button>
            </div>
            <div class="mobile-top-card">
               <p>{{ BLOG_DESCRIPTION }}</p>
            </div>

            <div class="floating-menu" id="floatingMenu" role="menu" aria-hidden="true">
               <div class="menu-items" id="menuItems">
                  <div class="menu-item" id="searchMenuItem" role="menuitem" tabindex="0">搜索</div>
                  <div class="menu-item" id="darkModeToggle" role="menuitem" tabindex="0">日间模式</div>
               </div>
            </div>
         </div>

         <div class="article-list-section" id="articleListSection">
            <div class="mobile-cards-container">
               <div class="mobile-cards-wrapper" id="mobileCardsWrapper">
               </div>
            </div>
         </div>

         <section class="special-card" id="specialCard" aria-labelledby="specialCardTitle" aria-expanded="false">
            <div class="special-card-header">
               <h3 id="specialCardTitle" class="special-card-title">{{ SPECIAL_NAME }}</h3>
            </div>
            <div class="special-card-content" id="specialCardContent">
               <div class="special-cards-container" id="specialCardsContainer">
               </div>
            </div>
         </section>
      </div>
   </div>

   <div class="search-overlay" id="searchOverlay">
      <div class="search-container">
         <div class="search-input-container">
            <input type="text" class="search-input" id="searchInput" placeholder="Enter确认,点击标题退出" autocomplete="off">
         </div>
         <div class="search-options" id="searchOptions">
            <button class="search-option active" data-type="title">标题</button>
            <button class="search-option" data-type="tag">标签</button>
            <button class="search-option" data-type="content">简介</button>
         </div>
      </div>
   </div>

   <script>
      // ==================== 数据注入点 (由生成引擎替换) ====================
      const blogData = {
        articles: {{ ARTICLES_JSON }},
        specials: {{ SPECIALS_JSON }}
      };
      const menuItemsData = {{ MENU_ITEMS_JSON }};
      const blogConfig = {
        themeColor: "{{ PRIMARY_COLOR }}",
        runDate: "{{ TOTAL_TIME }}"
      };
   
      // ==================== 状态管理 ====================
      const SEARCH_TYPES = { TITLE: 'title', TAG: 'tag', CONTENT: 'content' };
      const state = {
        isSearchMode: false,
        currentArticles: [],
        searchType: SEARCH_TYPES.TITLE
      };
   
      // ==================== 核心逻辑 ====================
   
      // 规格 4.4: 仅文本模式触发条件
      function shouldShowOnlyContent(special) {
        const hasTitle = special.title && special.title.trim() !== '';
        const hasTags = special.tags && special.tags.length > 0;
        const hasContent = special.content && special.content.length > 0;
        // 只有内容，没有标题和标签时触发
        return hasContent && !hasTitle && !hasTags;
      }
   
      function renderArticles(articles = blogData.articles, isSearchMode = false) {
        const wrapper = document.getElementById('mobileCardsWrapper');
        wrapper.innerHTML = '';
        
        // 按日期倒序
        const sorted = [...articles].sort((a, b) => new Date(b.date) - new Date(a.date));
   
        sorted.forEach((article, index) => {
          const card = document.createElement('article');
          card.className = 'rectangle-card';
          // 规格 3.3: 默认垂直标题为标签第一个
          const vTitle = article.verticalTitle || (article.tags && article.tags[0]) || 'Blog';
          
          // 构建标签HTML
          let tagsHTML = '';
          if (article.date) {
            tagsHTML += `<span class="card-tag date-tag">${article.date}</span>`;
          }
          if (article.tags && Array.isArray(article.tags)) {
            tagsHTML += article.tags.map(tag => `<span class="card-tag">${tag}</span>`).join('');
          }
          
          // 构建内容HTML
          let contentHTML = '';
          if (article.content && Array.isArray(article.content)) {
            contentHTML = article.content.map(p => `<p>${escapeHtml(p)}</p>`).join('');
          }
          
          card.innerHTML = `
            <div class="vertical-title">${escapeHtml(vTitle)}</div>
            <div class="card-content-expanded">
              <div class="card-tags">
                ${tagsHTML}
              </div>
              <div class="card-title-container">
                <h2>${escapeHtml(article.title)}</h2>
              </div>
              <div class="card-content-main">
                ${contentHTML}
              </div>
              <div class="card-footer">
                <button class="mobile-card-btn" onclick="window.location.href='${escapeHtml(article.url)}'">Read</button>
              </div>
            </div>
          `;
   
          // 搜索模式默认展开第一个，普通模式默认展开第二个(索引1)
          if ((!isSearchMode && index === 1) || (isSearchMode && index === 0)) {
            setTimeout(() => card.classList.add('active'), 100);
          }
   
          card.addEventListener('click', (e) => {
            if (e.target.closest('.mobile-card-btn')) return;
            document.querySelectorAll('.rectangle-card').forEach(c => c !== card && c.classList.remove('active'));
            card.classList.toggle('active');
          });
          wrapper.appendChild(card);
        });
      }
   
      function renderSpecialCards() {
        const container = document.getElementById('specialCardsContainer');
        const specialSection = document.getElementById('specialCard');
        container.innerHTML = '';
   
        if (!blogData.specials || blogData.specials.length === 0) {
          specialSection.style.display = 'none';
          return;
        }
   
        blogData.specials.forEach(special => {
          const item = document.createElement('div');
          
          if (shouldShowOnlyContent(special)) {
            // 仅文本模式
            specialSection.classList.add('only-content', 'expanded');
            item.className = 'special-card-item-content-simple';
            
            // 构建纯文本内容
            let contentHTML = '';
            if (special.content && Array.isArray(special.content)) {
              contentHTML = special.content.map(p => `<p>${escapeHtml(p)}</p>`).join('');
            }
            item.innerHTML = contentHTML;
          } else {
            // 正常模式
            item.className = 'special-card-item';
            
            // 构建标签HTML
            let tagsHTML = '';
            if (special.tags && Array.isArray(special.tags)) {
              tagsHTML = special.tags.map(t => `<span class="card-tag">${escapeHtml(t)}</span>`).join('');
            }
            
            // 构建内容HTML
            let contentHTML = '';
            if (special.content && Array.isArray(special.content)) {
              contentHTML = special.content.map(p => `<p>${escapeHtml(p)}</p>`).join('');
            }
            
            // 构建按钮HTML
            let buttonHTML = '';
            if (special.url) {
              buttonHTML = `
                <div class="special-card-item-footer">
                  <button class="special-card-btn" onclick="window.open('${escapeHtml(special.url)}', '_blank')">Visit</button>
                </div>
              `;
            }
            
            item.innerHTML = `
              <div class="special-card-item-content">
                <div class="card-tags">
                  ${tagsHTML}
                </div>
                <h4>${escapeHtml(special.title || '')}</h4>
                <div class="special-card-item-content-main">
                  ${contentHTML}
                </div>
                ${buttonHTML}
              </div>
            `;
          }
          container.appendChild(item);
        });
      }
   
      function renderMenu() {
        const menuContainer = document.getElementById('menuItems');
        const searchBtn = document.getElementById('searchMenuItem');
        const themeBtn = document.getElementById('darkModeToggle');
        
        // 保留搜索和主题切换，清空其他的
        menuContainer.innerHTML = '';
        menuContainer.appendChild(searchBtn);
   
        if (menuItemsData && Array.isArray(menuItemsData)) {
          menuItemsData.forEach(item => {
            // 如果item有url，直接使用
            if (item.url) {
              const link = document.createElement('a');
              link.className = 'menu-item';
              link.href = item.url;
              link.textContent = item.display;
              link.onclick = () => closeFloatingMenu();
              menuContainer.appendChild(link);
            } 
            // 如果item有tag，查找对应的文章
            else if (item.tag) {
              // 在articles中查找对应tag的文章
              const matchedArticle = blogData.articles.find(article => 
                article.tags && article.tags.includes(item.tag)
              );
              
              if (matchedArticle && matchedArticle.url) {
                const link = document.createElement('a');
                link.className = 'menu-item';
                link.href = matchedArticle.url;
                link.textContent = item.display || item.tag;
                link.onclick = () => closeFloatingMenu();
                menuContainer.appendChild(link);
              }
            }
            // 如果既没有url也没有tag，跳过不显示
          });
        }
   
        menuContainer.appendChild(themeBtn);
      }
   
      // ==================== 辅助函数 ====================
      function escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }
   
      // ==================== 交互事件 ====================
      function toggleFloatingMenu() {
        const menu = document.getElementById('floatingMenu');
        const isClosing = menu.classList.contains('active');
        if (isClosing) {
          menu.classList.add('closing');
          menu.classList.remove('active');
          setTimeout(() => menu.classList.remove('closing'), 250);
        } else {
          menu.classList.add('active');
        }
      }
   
      function closeFloatingMenu() {
        const menu = document.getElementById('floatingMenu');
        if(menu.classList.contains('active')) toggleFloatingMenu();
      }
   
      function performSearch() {
        const input = document.getElementById('searchInput');
        const keyword = input.value.trim().toLowerCase();
        if (!keyword) return;
   
        const filtered = blogData.articles.filter(a => {
          if (!a) return false;
          
          if (state.searchType === SEARCH_TYPES.TITLE) {
            return a.title && a.title.toLowerCase().includes(keyword);
          }
          if (state.searchType === SEARCH_TYPES.TAG) {
            return a.tags && a.tags.some(t => t && t.toLowerCase().includes(keyword));
          }
          if (state.searchType === SEARCH_TYPES.CONTENT) {
            return a.content && a.content.some(c => c && c.toLowerCase().includes(keyword));
          }
          return false;
        });
   
        if (filtered.length > 0) {
          state.isSearchMode = true;
          renderArticles(filtered, true);
          document.getElementById('searchOverlay').classList.remove('active');
          input.value = '';
          input.placeholder = '输入关键词搜索...';
        } else {
          input.classList.add('error');
          setTimeout(() => {
            input.classList.remove('error');
            input.placeholder = '未找到相关内容';
          }, 500);
        }
      }
   
      // ==================== 初始化 ====================
      document.addEventListener('DOMContentLoaded', () => {
        renderArticles();
        renderSpecialCards();
        renderMenu();
   
        // 基础事件绑定
        document.getElementById('menuBtn').addEventListener('click', toggleFloatingMenu);
        document.getElementById('searchMenuItem').addEventListener('click', () => {
          document.getElementById('searchOverlay').classList.add('active');
          document.getElementById('searchInput').focus();
          closeFloatingMenu();
        });
        document.getElementById('darkModeToggle').addEventListener('click', () => {
          document.body.classList.toggle('light-mode');
          document.body.classList.toggle('dark-mode');
          const isLight = document.body.classList.contains('light-mode');
          document.getElementById('darkModeToggle').textContent = isLight ? '夜间模式' : '日间模式';
          closeFloatingMenu();
        });
        document.getElementById('titleToggle').addEventListener('click', () => {
          if (state.isSearchMode) {
            state.isSearchMode = false;
            renderArticles();
          } else {
            document.getElementById('mobileTopSection').classList.toggle('expanded');
            document.getElementById('mobileTopSection').classList.toggle('collapsed');
          }
        });
        
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            performSearch();
          }
        });
        
        // 点击外部关闭
        document.addEventListener('click', (e) => {
          if (!e.target.closest('#floatingMenu') && !e.target.closest('#menuBtn')) {
            closeFloatingMenu();
          }
          if (e.target.id === 'searchOverlay') {
            e.target.classList.remove('active');
            const input = document.getElementById('searchInput');
            input.value = '';
            input.placeholder = '输入关键词搜索...';
          }
        });
   
        // 搜索类型切换
        document.querySelectorAll('.search-option').forEach(btn => {
          btn.addEventListener('click', () => {
            document.querySelectorAll('.search-option').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            state.searchType = btn.dataset.type;
          });
        });
   
        // Special Header 点击
        const specialHeader = document.querySelector('.special-card-header');
        if (specialHeader) {
          specialHeader.addEventListener('click', () => {
            const card = document.getElementById('specialCard');
            if (card && !card.classList.contains('only-content')) {
              card.classList.toggle('expanded');
            }
          });
        }
      });
      
      // 设置主题颜色
      if (blogConfig.themeColor) {
        document.documentElement.style.setProperty('--primary-color', blogConfig.themeColor);
      }
   </script>
</body>

</html>
