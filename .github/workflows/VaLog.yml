name: Deploy VaLog Blog

on:
  push:
    branches: [main]
  issues:
    types: [opened, edited, reopened]
  workflow_dispatch:

# å…³é”®ï¼šå¿…é¡»è®¾ç½®è¿™äº›æƒé™
permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    # éƒ¨ç½²ç¯å¢ƒ
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
        cache: 'pip'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install PyYAML markdown requests Jinja2
    
    - name: Generate VaLog Blog
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        echo "ğŸ¯ ç”Ÿæˆ VaLog åšå®¢..."
        
        # æ˜¾ç¤ºç¯å¢ƒä¿¡æ¯
        echo "å·¥ä½œç›®å½•: $(pwd)"
        echo "ä»“åº“: ${{ github.repository }}"
        echo "äº‹ä»¶: ${{ github.event_name }}"
        
        # æ£€æŸ¥æ–‡ä»¶å’Œç›®å½•
        echo "ğŸ“ å½“å‰ç›®å½•ç»“æ„:"
        ls -la
        
        # ç”Ÿæˆåšå®¢
        python VaLog.py
        
        echo "âœ… åšå®¢ç”Ÿæˆå®Œæˆ"
        
        # ç¡®ä¿åˆ›å»ºäº†å¿…è¦çš„éƒ¨ç½²æ–‡ä»¶
        touch docs/.nojekyll
        
        # æ˜¾ç¤ºç”Ÿæˆçš„æ–‡ä»¶
        echo "ğŸ“„ ç”Ÿæˆçš„æ–‡ä»¶:"
        find docs -type f | head -20
    
    - name: Setup Pages
      uses: actions/configure-pages@v4
    
    - name: Upload artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: 'docs'
    
    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4
    
    - name: Success Message
      run: |
        echo "=========================================="
        echo "âœ… VaLog åšå®¢éƒ¨ç½²æˆåŠŸï¼"
        echo "=========================================="
        echo ""
        echo "ğŸŒ è®¿é—®åœ°å€:"
        echo "  https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/"
        echo ""
        echo "ğŸ”§ GitHub Pages è®¾ç½®:"
        echo "  https://github.com/${{ github.repository }}/settings/pages"
        echo ""
        echo "ğŸ“Š éƒ¨ç½²ç¯å¢ƒ: ${{ job.environment }}"
        echo "ğŸ“… éƒ¨ç½²æ—¶é—´: $(date)"
        echo "=========================================="